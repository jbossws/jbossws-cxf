<?xml version="1.0" encoding="UTF-8"?>

<!-- ====================================================================== -->
<!--                                                                        -->
<!--  JBoss, the OpenSource J2EE webOS                                      -->
<!--                                                                        -->
<!--  Distributable under LGPL license.                                     -->
<!--  See terms of license at http://www.gnu.org.                           -->
<!--                                                                        -->
<!-- ====================================================================== -->

<!-- $Id$ -->

<project>

  <target name="init-project-properties" depends="tests-init">
  	<fail message="Did you copy the ant.properties.example to ant.properties?" unless="jboss.home"/>
    <property file="./user-project.properties" />
    <property name="project.home" value="${workspace.home}/${project.name}"/>
    
    <filterset id="project">
      <filter token="projectName" value="${project.name}" />
      <filter token="jbossHome" value="${project.jboss.home}" />
   	</filterset>
  	
  	<path id="jbws-ant.path">
  		<pathelement location="${thirdparty.dir}/jbossws-common.jar" />
  	</path>
  	<taskdef name="pathFixer" classname="org.jboss.ws.tools.ant.FixPathTask" classpathref="jbws-ant.path"/>
  	<taskdef name="eclipseClasspathGenerator" classname="org.jboss.ws.tools.ant.EclipseClasspathTask" classpathref="jbws-ant.path"/>
  	<taskdef name="eclipseProjectGenerator" classname="org.jboss.ws.tools.ant.EclipseProjectTask" classpathref="jbws-ant.path"/>
  	<taskdef name="pathWriter" classname="org.jboss.ws.tools.ant.PathWriterTask" classpathref="jbws-ant.path"/>
  </target>

  <target name="setup-new-project" depends="init-project-properties" description="Prompt for settings and setup configuration for a new user project">
    <property file="./user-project.properties" prefix="old" />
    
    <echo message="-------------------------------------------------"/>
    <echo message="  Welcome to the JBossWS user project generator"/>
    <echo message="-------------------------------------------------"/>
    <echo message=""/>
  	
	<property name="old.workspace.home" value="C:/Projects"/>
    <input addproperty="workspace.home.new" 
           message="Enter your Java project workspace (the directory that contains your projects) " 
           defaultvalue="${old.workspace.home}"/>
    <pathFixer property="workspace.home.new" />
    
    <property name="old.project.name" value="myproject"/>
    <input addproperty="project.name.new" 
           message="Enter the project name " 
           defaultvalue="${old.project.name}"/>
    
    <property name="old.project.type" value="jar"/>
    <input addproperty="project.type.new" 
           message="Is this project deployed as an JAR (with EJB3 components) or a WAR (with no EJB3 support) " 
           validargs="jar,war"
           defaultvalue="${old.project.type}"/>
    
    <delete file="user-project.properties"/>
    <propertyfile file="user-project.properties" comment="Generated by JBossWS user project setup">
        <entry key="workspace.home" value="${workspace.home.new}"/>
        <entry key="project.name" value="${project.name.new}"/>
        <entry key="project.type" value="${project.type.new}"/>
        <entry key="project.jboss.home" value="${jboss.home}"/>
        <entry key="project.jboss.conf" value="${jboss.server.instance}"/>
    </propertyfile>
    
    <echo message=""/>
    <echo message="Your project settings have been saved in file 'user-project.properties'."/>
    <echo message="Please type 'ant create-project' to create the new project."/>
  </target>

  <target name="create-project" depends="validate-settings, configure-project" description="Create a new user project">
    <echo message="A basic webservice project named '${project.name}' has been created in the ${workspace.home} directory."/>
    <echo message="It includes a simple Ant build file and references the required libraries."/>
    <echo message="Please refer to http://jbws.dyndns.org/mediawiki/index.php?title=JBossWS for the authoritative documentation."/>
    <echo message=""/>
    <echo message="If you are an Eclipse user, import the project into Eclipse: right click in "/>
    <echo message="'Package Explorer -> Import...' and select 'General -> Existing Projects into Workspace'."/>
    <echo message="Then click on 'Next' and set the root directory browsing to your workspace directory."/>
  </target>
  
  <target name="validate-settings" depends="init-project-properties">
    <fail message="No project name specified (run 'ant setup-new-project' first)">
      <condition>
        <or>
          <not><isset property="project.name"/></not>
          <equals arg1="${project.name}" arg2=""/>
        </or>
      </condition>
    </fail>
    <fail message="No project workspace specified (run 'ant setup-new-project' first)">
      <condition>
        <or>
          <not><isset property="workspace.home"/></not>
          <equals arg1="${workspace.home}" arg2=""/>
        </or>
      </condition>
    </fail>
  </target>
  
  <target name="configure-project">
    <mkdir dir="${project.home}/src/main/java"/>
    <mkdir dir="${project.home}/src/main/resources"/>
    <copy tofile="${project.home}/build.xml" file="${basedir}/build/user-project-build.xml">
      <filterset refid="project"/>
    </copy>
    <copy tofile="${project.home}/build.properties" file="${basedir}/user-project.properties"/>
  	<path id="project.classpath">
        <pathelement location="${jboss.client}/jbossws-common.jar"/>
        <pathelement location="${jboss.client}/jbossws-spi.jar"/>
        <pathelement location="${jboss.client}/jbossws-cxf-client.jar"/>
  		<pathelement location="${jboss.client}/geronimo-ws-metadata_2.0_spec.jar"/>
        <path refid="integration.target.javac.classpath" />
	</path>
  	<eclipseClasspathGenerator pathId="project.classpath" outputFile="${project.home}/.classpath" srcPath="src/main/java" srcOutput="bin/main" />
  	<eclipseProjectGenerator projectName="${project.name}" outputFile="${project.home}/.project" />
  	<pathWriter pathId="project.classpath" outputFile="${project.home}/libraries.xml" variables="project.jboss.home" />
  </target>
  
  <target name="delete-project" depends="validate-settings" description="Delete the configured user project">
    <echo message="Deleting the entire project in ${project.home}" />
    <delete dir="${project.home}" />
  </target>
  
  <target name="settings" depends="init-project-properties" description="Print the current project settings">
    <echo message="Java project workspace: ${workspace.home}"/>
    <echo message="JBoss home: ${project.jboss.home}"/>
    <echo message="JBoss conf: ${project.jboss.conf}"/>
    <echo message="Project name: ${project.name}"/>
    <echo message="Project type: ${project.type}"/>
  </target>
  
</project>